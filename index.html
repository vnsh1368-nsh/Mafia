<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¨Ø§Ø²ÛŒ Ù…Ø§ÙÛŒØ§</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --danger: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --dark: #1e293b;
      --light: #f8fafc;
      --border: #e2e8f0;
    }

    body {
      font-family: 'Segoe UI', 'Tahoma', sans-serif;
      direction: rtl;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 1200px;
      width: 100%;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 42px;
      color: var(--dark);
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header-subtitle {
      color: #64748b;
      font-size: 16px;
      letter-spacing: 1px;
    }

    .emoji-title {
      font-size: 50px;
      margin-bottom: 15px;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .section {
      background: linear-gradient(135deg, #f8fafc 0%, #eff6ff 100%);
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 30px;
      border: 2px solid var(--border);
      display: none;
    }

    .section.show {
      display: block;
      animation: slideUp 0.4s ease-out;
    }

    .section h2 {
      font-size: 22px;
      color: var(--dark);
      margin-bottom: 25px;
      font-weight: 700;
      text-align: center;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .setting-group {
      display: flex;
      align-items: center;
      gap: 15px;
      justify-content: center;
      flex-direction: column;
    }

    .setting-label {
      font-size: 16px;
      font-weight: 600;
      color: var(--dark);
      min-width: fit-content;
    }

    input[type="number"],
    input[type="text"] {
      width: 100%;
      max-width: 200px;
      padding: 12px;
      font-size: 16px;
      text-align: center;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-weight: 600;
      color: var(--primary);
      transition: all 0.3s ease;
      background: white;
    }

    input[type="number"]:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .players-names-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .player-name-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .player-name-input-group label {
      font-size: 14px;
      font-weight: 600;
      color: var(--dark);
    }

    .player-name-input-group input {
      padding: 12px;
      font-size: 16px;
      border: 2px solid var(--border);
      border-radius: 10px;
      transition: all 0.3s ease;
      background: white;
      text-align: right;
    }

    .player-name-input-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .roles-selection {
      background: white;
      padding: 25px;
      border-radius: 16px;
      border: 2px solid var(--border);
      margin-bottom: 20px;
      display: none;
    }

    .roles-selection.show {
      display: block;
      animation: slideUp 0.4s ease-out;
    }

    .roles-selection h3 {
      font-size: 18px;
      color: var(--dark);
      margin-bottom: 20px;
      font-weight: 700;
      text-align: center;
    }

    .roles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .role-checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px;
      background: var(--light);
      border-radius: 10px;
      border: 2px solid var(--border);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .role-checkbox-item:hover {
      border-color: var(--primary);
      background: #f0f4ff;
    }

    .role-checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: var(--primary);
    }

    .role-checkbox-label {
      flex: 1;
      cursor: pointer;
    }

    .role-checkbox-emoji {
      font-size: 24px;
      min-width: 30px;
      text-align: center;
    }

    .role-checkbox-name {
      font-weight: 600;
      color: var(--dark);
      font-size: 15px;
      display: block;
      margin-bottom: 4px;
    }

    .role-checkbox-count {
      font-size: 13px;
      color: #64748b;
      display: block;
    }

    .btn-container {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 14px 32px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 200px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .players-area {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
      min-height: 100px;
      display: none;
    }

    .players-area.show {
      display: grid;
    }

    .player-btn {
      padding: 20px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      position: relative;
      overflow: hidden;
      word-wrap: break-word;
      word-break: break-word;
      white-space: normal;
    }

    .player-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.2);
      transition: left 0.3s ease;
    }

    .player-btn:hover::before {
      left: 100%;
    }

    .player-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }

    .player-btn:active {
      transform: translateY(-1px);
    }

    .player-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);
    }

    .player-btn.revealed {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .role-box {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-out;
    }

    .role-box.show {
      display: flex;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .role-content {
      background: white;
      padding: 50px;
      border-radius: 20px;
      text-align: center;
      max-width: 500px;
      animation: popIn 0.4s ease-out;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    @keyframes popIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .role-player-name {
      font-size: 24px;
      color: var(--primary);
      margin-bottom: 20px;
      font-weight: 700;
    }

    .role-label {
      font-size: 18px;
      color: #64748b;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 600;
    }

    .role-name {
      font-size: 48px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 20px;
    }

    .role-emoji {
      font-size: 60px;
      margin-bottom: 20px;
      animation: rotate 2s infinite;
    }

    @keyframes rotate {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-5deg); }
      75% { transform: rotate(5deg); }
    }

    .role-timer {
      margin-top: 20px;
      font-size: 14px;
      color: #94a3b8;
      font-weight: 600;
    }

    .role-descriptions {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid var(--border);
    }

    .role-descriptions h3 {
      font-size: 20px;
      color: var(--dark);
      margin-bottom: 20px;
      font-weight: 700;
    }

    .role-desc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .role-card {
      background: var(--light);
      padding: 15px;
      border-radius: 12px;
      border-left: 4px solid var(--primary);
    }

    .role-card-title {
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 8px;
      font-size: 15px;
    }

    .role-card-desc {
      font-size: 13px;
      color: #64748b;
      line-height: 1.5;
    }

    .stats-section {
      background: var(--light);
      padding: 20px;
      border-radius: 16px;
      margin-top: 30px;
      display: none;
    }

    .stats-section.show {
      display: block;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .stat-item {
      background: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid var(--border);
    }

    .stat-number {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-label {
      font-size: 13px;
      color: #64748b;
      margin-top: 5px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .info-message {
      background: #eff6ff;
      border: 2px solid #bfdbfe;
      padding: 15px;
      border-radius: 10px;
      color: #1e40af;
      font-size: 14px;
      margin-top: 15px;
      text-align: center;
      display: none;
    }

    .info-message.show {
      display: block;
    }

    .game-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      display: none;
    }

    .game-header.show {
      display: block;
    }

    .game-header h2 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .game-header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .edit-players-btn {
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }

    .edit-players-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
    }

    .new-round-section {
      background: white;
      padding: 25px;
      border-radius: 16px;
      border: 2px solid var(--border);
      text-align: center;
      display: none;
      margin-top: 30px;
    }

    .new-round-section.show {
      display: block;
      animation: slideUp 0.4s ease-out;
    }

    .new-round-section h3 {
      font-size: 20px;
      color: var(--dark);
      margin-bottom: 20px;
      font-weight: 700;
    }

    .new-round-section p {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .card {
        padding: 20px;
      }

      .header h1 {
        font-size: 28px;
      }

      .emoji-title {
        font-size: 40px;
      }

      .settings-grid {
        grid-template-columns: 1fr;
      }

      .setting-group {
        flex-direction: column;
      }

      .role-content {
        padding: 30px;
        margin: 20px;
      }

      .role-name {
        font-size: 36px;
      }

      .role-emoji {
        font-size: 48px;
      }

      .players-area {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }

      .roles-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }

      .players-names-grid {
        grid-template-columns: 1fr;
      }

      .btn-container {
        flex-direction: column;
      }

      .btn {
        min-width: 100%;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .card {
        padding: 15px;
        border-radius: 15px;
      }

      .header h1 {
        font-size: 24px;
      }

      .emoji-title {
        font-size: 35px;
      }

      .players-area {
        grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));
        gap: 10px;
      }

      .player-btn {
        padding: 15px;
        font-size: 13px;
      }

      .role-content {
        padding: 20px;
      }

      .role-name {
        font-size: 32px;
      }

      .roles-grid {
        grid-template-columns: 1fr;
      }

      .players-names-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="emoji-title">ğŸ”ªğŸ•µï¸</div>
        <h1>Ø¨Ø§Ø²ÛŒ Ù…Ø§ÙÛŒØ§</h1>
        <p class="header-subtitle">ÛŒÚ© Ø¨Ø§Ø²ÛŒ ØªÛŒÙ…ÛŒ Ùˆ Ø¬Ø°Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØ§Ù†</p>
      </div>

      <!-- Ø¨Ø®Ø´ Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§ -->
      <div class="section show" id="numPlayersSection">
        <h2>ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</h2>
        <div class="settings-grid">
          <div class="setting-group">
            <label class="setting-label">ğŸ“Š ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†:</label>
            <input type="number" id="numPlayers" min="4" max="20" value="5">
          </div>
        </div>
        <div class="btn-container">
          <button class="btn btn-success" onclick="goToPlayersNames()">âœ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§</button>
        </div>
      </div>

      <!-- Ø¨Ø®Ø´ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§ -->
      <div class="section" id="playersNamesSection">
        <h2>ğŸ‘¤ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§</h2>
        <div class="players-names-grid" id="playersNamesGrid">
          <!-- ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        <div class="btn-container">
          <button class="btn btn-primary" onclick="goBack()">âœ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
          <button class="btn btn-success" onclick="savePlayersNames()">âœ“ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§</button>
        </div>
      </div>

      <!-- Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø´â€ŒÙ‡Ø§ -->
      <div class="section" id="rolesSection">
        <h2>ğŸ­ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ</h2>
        
        <div class="roles-selection">
          <div class="roles-grid" id="rolesGrid">
            <!-- Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
          </div>
          <div class="info-message" id="infoMessage"></div>
        </div>

        <div class="btn-container">
          <button class="btn btn-primary" onclick="editPlayerNames()">âœ ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø§Ù…â€ŒÙ‡Ø§</button>
          <button class="btn btn-success" onclick="startGame()">ğŸ® Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
        </div>
      </div>

      <!-- Ø¨Ø®Ø´ Ø¨Ø§Ø²ÛŒ -->
      <div class="section" id="gameSection">
        <div class="game-header" id="gameHeader">
          <h2>ğŸ® Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯!</h2>
          <p>Ø¨Ø± Ø±ÙˆÛŒ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†Ù‚Ø´ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
        </div>

        <div class="stats-section" id="statsSection">
          <h3 style="text-align: center; margin-bottom: 15px; color: var(--dark);">ğŸ“ˆ Ø¢Ù…Ø§Ø± Ø¨Ø§Ø²ÛŒ</h3>
          <div class="stats-grid" id="statsGrid">
            <!-- Ø¢Ù…Ø§Ø± Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
          </div>
        </div>

        <div id="playersArea" class="players-area"></div>

        <div class="new-round-section" id="newRoundSection">
          <h3>ğŸ‰ Ø§ÛŒÙ† Ø¯Ø³Øª Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯!</h3>
          <p>Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø³Øª Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯ØŸ</p>
          <div class="btn-container">
            <button class="btn btn-primary" onclick="editPlayerNames()">âœ ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø§Ù…â€ŒÙ‡Ø§</button>
            <button class="btn btn-success" onclick="newRound()">âœ Ø¯Ø³Øª Ø¬Ø¯ÛŒØ¯</button>
          </div>
        </div>
      </div>

      <div id="roleBox" class="role-box">
        <div class="role-content">
          <div class="role-player-name" id="rolePlayerName">Ø¨Ø§Ø²ÛŒÚ©Ù†</div>
          <div class="role-emoji" id="roleEmoji">ğŸ­</div>
          <div class="role-label">Ù†Ù‚Ø´ Ø´Ù…Ø§</div>
          <div class="role-name" id="roleName">Ù…Ø§ÙÛŒØ§</div>
          <div class="role-timer" id="roleTimer">3 Ø«Ø§Ù†ÛŒÙ‡ ØªØ§ Ø¨Ø³ØªÙ†</div>
        </div>
      </div>

      <div class="role-descriptions">
        <h3>ğŸ“‹ ØªÙˆØ¶ÛŒØ­ Ù†Ù‚Ø´â€ŒÙ‡Ø§</h3>
        <div class="role-desc-grid" id="roleDescGrid">
          <!-- ØªÙˆØ¶ÛŒØ­ Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>
      </div>
    </div>
  </div>

  <script>
    const allRoles = {
      "Ø¯Ú©ØªØ±": { emoji: "âš•ï¸", description: "Ù‡Ø± Ø´Ø¨ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ù†Ù‚Ø§Ù‡Øª Ø¯Ù‡Ø¯ Ùˆ Ø¬Ø§Ù† Ø¨Ø®Ø´Ø¯.", required: true },
      "Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡": { emoji: "ğŸ”", description: "Ù‡Ø± Ø´Ø¨ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†Ø¯ Ùˆ Ù†Ù‚Ø´ Ø¢Ù† Ø±Ø§ Ø¨ÛŒØ§Ø¨Ø¯.", required: true },
      "Ù…Ø§ÙÛŒØ§": { emoji: "ğŸ•µï¸", description: "Ù‡Ø± Ø´Ø¨ ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø§Ø² Ø¨ÛŒÙ† Ù…ÛŒâ€ŒØ¨Ø±Ù†Ø¯. Ø¨Ø§ÛŒØ¯ Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ø±Ø§ ÙØ±ÛŒØ¨ Ø¨Ø¯Ù‡Ù†Ø¯.", required: true },
      "ØªÙÙ†Ú¯Ø¯Ø§Ø±": { emoji: "ğŸ”«", description: "Ø´Ù‡Ø±ÙˆÙ†Ø¯ÛŒ Ú©Ù‡ ÛŒÚ© Ø¨Ø§Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø´Ø¨â€ŒÙ‡Ø§ Ø´Ù„ÛŒÚ© Ú©Ù†Ø¯.", required: false },
      "Ø¬Ø§Ù†â€ŒØ³Ø®Øª": { emoji: "ğŸ’ª", description: "Ø´Ù‡Ø±ÙˆÙ†Ø¯ÛŒ Ú©Ù‡ Ø§Ø² ÛŒÚ© Ù…ÙˆØ±Ø¯ Ø­Ù…Ù„Ù‡ Ù…Ø§ÙÛŒØ§ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.", required: false },
      "Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ": { emoji: "ğŸ¯", description: "Ø´Ù‡Ø±ÙˆÙ†Ø¯ÛŒ Ú©Ù‡ ØªÙˆØ§Ù†Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ Ø®Ø§ØµÛŒ Ø¯Ø§Ø±Ø¯.", required: false },
      "Ø´Ù‡Ø±ÙˆÙ†Ø¯": { emoji: "ğŸ‘¥", description: "Ù†Ù‚Ø´ Ù¾Ø§ÛŒÙ‡ Ø¨Ø§Ø²ÛŒ. Ø¨Ø§ÛŒØ¯ Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ Ø­Ø°Ù Ú©Ù†Ù†Ø¯.", required: false }
    };

    let selectedRoles = {};
    let playerRoles = [];
    let playerNames = [];
    let revealedPlayers = new Set();
    let countdownInterval = null;
    let numPlayers = 5;
    let currentSection = "numPlayers";

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø§Ù…â€ŒÙ‡Ø§ Ø§Ø² localStorage
    function loadPlayerNames() {
      const saved = localStorage.getItem("mafiaPlayerNames");
      if (saved) {
        try {
          playerNames = JSON.parse(saved);
          return true;
        } catch (e) {
          return false;
        }
      }
      return false;
    }

    // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ Ø¯Ø± localStorage
    function savePlayerNamesToStorage() {
      localStorage.setItem("mafiaPlayerNames", JSON.stringify(playerNames));
    }

    function showSection(sectionId) {
      document.querySelectorAll(".section").forEach(s => s.classList.remove("show"));
      document.getElementById(sectionId).classList.add("show");
      currentSection = sectionId;
    }

    function goToPlayersNames() {
      numPlayers = parseInt(document.getElementById("numPlayers").value);
      if (isNaN(numPlayers) || numPlayers < 4 || numPlayers > 20) {
        alert("Ù„Ø·ÙØ§ Ø¹Ø¯Ø¯ÛŒ Ø¨ÛŒÙ† 4 Ùˆ 20 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!");
        return;
      }

      // Ø§Ú¯Ø± Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´Øª Ùˆ ØªØ¹Ø¯Ø§Ø¯ ÛŒÚ©Ø³Ø§Ù† Ø§Ø³ØªØŒ Ø§Ø² Ø¢Ù†Ù‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
      if (playerNames.length !== numPlayers) {
        playerNames = [];
        for (let i = 0; i < numPlayers; i++) {
          playerNames.push(`Ø¨Ø§Ø²ÛŒÚ©Ù† ${i + 1}`);
        }
      }

      renderPlayersNamesInputs();
      showSection("playersNamesSection");
    }

    function renderPlayersNamesInputs() {
      const playersNamesGrid = document.getElementById("playersNamesGrid");
      playersNamesGrid.innerHTML = "";

      for (let i = 0; i < numPlayers; i++) {
        const inputGroup = document.createElement("div");
        inputGroup.className = "player-name-input-group";
        
        const label = document.createElement("label");
        label.textContent = `Ø¨Ø§Ø²ÛŒÚ©Ù† ${i + 1}`;
        
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = `Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† ${i + 1}`;
        input.id = `player-name-${i}`;
        input.value = playerNames[i] || `Ø¨Ø§Ø²ÛŒÚ©Ù† ${i + 1}`;
        
        inputGroup.appendChild(label);
        inputGroup.appendChild(input);
        playersNamesGrid.appendChild(inputGroup);
      }
    }

    function savePlayersNames() {
      playerNames = [];
      let valid = true;

      for (let i = 0; i < numPlayers; i++) {
        const input = document.getElementById(`player-name-${i}`);
        const name = input.value.trim();
        
        if (!name) {
          alert(`Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† ${i + 1} Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!`);
          valid = false;
          break;
        }
        
        playerNames.push(name);
      }

      if (valid) {
        savePlayerNamesToStorage();
        renderRoleSelections();
        showSection("rolesSection");
      }
    }

    function editPlayerNames() {
      renderPlayersNamesInputs();
      showSection("playersNamesSection");
    }

    function goBack() {
      showSection("numPlayersSection");
    }

    function renderRoleSelections() {
      const rolesGrid = document.getElementById("rolesGrid");
      rolesGrid.innerHTML = "";
      selectedRoles = {};

      let numMafia = (numPlayers <= 4) ? 1 :
                     (numPlayers <= 7) ? 2 :
                     (numPlayers <= 10) ? 3 :
                     (numPlayers <= 13) ? 4 :
                     (numPlayers <= 16) ? 5 : 6;

      // Ø§Ø¨ØªØ¯Ø§ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ
      selectedRoles["Ø¯Ú©ØªØ±"] = 1;
      selectedRoles["Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡"] = 1;
      selectedRoles["Ù…Ø§ÙÛŒØ§"] = numMafia;

      // Ø­Ø§Ù„Ø§ ØªÙ…Ø§Ù… Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø±Ø§ Ø±Ù†Ø¯Ø± Ú©Ù†
      for (const [role, info] of Object.entries(allRoles)) {
        const count = selectedRoles[role] || 0;
        const roleDiv = document.createElement("div");
        roleDiv.className = "role-checkbox-item";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = "role-" + role;
        checkbox.checked = info.required || (count > 0);
        checkbox.disabled = info.required;
        checkbox.onchange = () => updateRoleCount();

        const label = document.createElement("label");
        label.className = "role-checkbox-label";
        label.htmlFor = "role-" + role;

        const emoji = document.createElement("div");
        emoji.className = "role-checkbox-emoji";
        emoji.textContent = info.emoji;

        const nameSpan = document.createElement("span");
        nameSpan.className = "role-checkbox-name";
        nameSpan.textContent = role;

        const countSpan = document.createElement("span");
        countSpan.className = "role-checkbox-count";
        countSpan.id = "count-" + role;
        countSpan.textContent = count > 0 ? `${count} Ù†ÙØ±` : "0";

        label.appendChild(emoji);
        label.appendChild(nameSpan);
        label.appendChild(countSpan);

        roleDiv.appendChild(checkbox);
        roleDiv.appendChild(label);
        rolesGrid.appendChild(roleDiv);
      }

      updateRoleCount();
    }

    function updateRoleCount() {
      const checkedRoles = [];
      document.querySelectorAll(".role-checkbox-item input[type='checkbox']:checked").forEach(cb => {
        const roleName = cb.id.replace("role-", "");
        checkedRoles.push(roleName);
      });

      let numMafia = selectedRoles["Ù…Ø§ÙÛŒØ§"] || 0;
      let optionalRoles = [];

      // Ø´Ù…Ø§Ø±Ø´ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª
      for (const [role, info] of Object.entries(allRoles)) {
        if (!info.required && checkedRoles.includes(role)) {
          optionalRoles.push(role);
        }
      }

      let remaining = numPlayers - (3 + numMafia);

      // ØªÙˆØ²ÛŒØ¹ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ
      for (let i = 0; i < optionalRoles.length && remaining > 0; i++) {
        selectedRoles[optionalRoles[i]] = 1;
        remaining--;
        document.getElementById("count-" + optionalRoles[i]).textContent = "1 Ù†ÙØ±";
      }

      // Ø¨Ù‚ÛŒÙ‡ Ø´Ù‡Ø±ÙˆÙ†Ø¯
      if (remaining > 0) {
        selectedRoles["Ø´Ù‡Ø±ÙˆÙ†Ø¯"] = remaining;
      } else {
        selectedRoles["Ø´Ù‡Ø±ÙˆÙ†Ø¯"] = 0;
      }

      document.getElementById("count-Ø´Ù‡Ø±ÙˆÙ†Ø¯").textContent = selectedRoles["Ø´Ù‡Ø±ÙˆÙ†Ø¯"] > 0 ? `${selectedRoles["Ø´Ù‡Ø±ÙˆÙ†Ø¯"]} Ù†ÙØ±` : "0";

      // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª
      let totalSelected = 0;
      for (const [role, info] of Object.entries(allRoles)) {
        if (checkedRoles.includes(role)) {
          totalSelected += selectedRoles[role] || 0;
        }
      }

      const infoMsg = document.getElementById("infoMessage");
      if (totalSelected < numPlayers) {
        infoMsg.textContent = `âš ï¸ ${numPlayers - totalSelected} Ù†ÙØ± Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯`;
        infoMsg.classList.add("show");
      } else if (totalSelected > numPlayers) {
        infoMsg.textContent = `âŒ ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø¨ÛŒØ´ØªØ± Ø§Ø² ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§ Ø§Ø³Øª!`;
        infoMsg.classList.add("show");
      } else {
        infoMsg.classList.remove("show");
      }
    }

    function startGame() {
      revealedPlayers.clear();

      let roles = [];
      let totalCount = 0;

      for (const [role, count] of Object.entries(selectedRoles)) {
        if (count > 0) {
          for (let i = 0; i < count; i++) {
            roles.push(role);
            totalCount++;
          }
        }
      }

      if (totalCount < numPlayers) {
        let remaining = numPlayers - totalCount;
        for (let i = 0; i < remaining; i++) {
          roles.push("Ø´Ù‡Ø±ÙˆÙ†Ø¯");
        }
      }

      playerRoles = shuffle([...roles]);

      let area = document.getElementById("playersArea");
      area.innerHTML = "";
      area.classList.add("show");
      
      for (let i = 0; i < numPlayers; i++) {
        let btn = document.createElement("button");
        btn.className = "player-btn";
        btn.textContent = playerNames[i];
        btn.onclick = () => showRole(i, btn);
        area.appendChild(btn);
      }

      updateStats();
      document.getElementById("statsSection").classList.add("show");
      document.getElementById("gameHeader").classList.add("show");
      showSection("gameSection");
    }

    function newRound() {
      revealedPlayers.clear();
      
      let roles = [];
      let totalCount = 0;

      for (const [role, count] of Object.entries(selectedRoles)) {
        if (count > 0) {
          for (let i = 0; i < count; i++) {
            roles.push(role);
            totalCount++;
          }
        }
      }

      if (totalCount < numPlayers) {
        let remaining = numPlayers - totalCount;
        for (let i = 0; i < remaining; i++) {
          roles.push("Ø´Ù‡Ø±ÙˆÙ†Ø¯");
        }
      }

      playerRoles = shuffle([...roles]);

      let area = document.getElementById("playersArea");
      area.innerHTML = "";
      
      for (let i = 0; i < numPlayers; i++) {
        let btn = document.createElement("button");
        btn.className = "player-btn";
        btn.textContent = playerNames[i];
        btn.onclick = () => showRole(i, btn);
        area.appendChild(btn);
      }

      document.getElementById("newRoundSection").classList.remove("show");
    }

    function updateStats() {
      const statsGrid = document.getElementById("statsGrid");
      statsGrid.innerHTML = "";

      const stats = {};
      playerRoles.forEach(role => {
        stats[role] = (stats[role] || 0) + 1;
      });

      for (const [role, count] of Object.entries(stats)) {
        const statItem = document.createElement("div");
        statItem.className = "stat-item";
        statItem.innerHTML = `
          <div class="stat-number">${count}</div>
          <div class="stat-label">${allRoles[role].emoji} ${role}</div>
        `;
        statsGrid.appendChild(statItem);
      }
    }

    function showRole(index, btn) {
      if (revealedPlayers.has(index)) return;

      let role = playerRoles[index];
      let roleBox = document.getElementById("roleBox");
      let rolePlayerName = document.getElementById("rolePlayerName");
      let roleName = document.getElementById("roleName");
      let roleEmoji = document.getElementById("roleEmoji");
      let roleTimer = document.getElementById("roleTimer");

      rolePlayerName.textContent = playerNames[index];
      roleEmoji.textContent = allRoles[role].emoji;
      roleName.textContent = role;
      roleBox.classList.add("show");

      let timeLeft = 3;
      roleTimer.textContent = timeLeft + " Ø«Ø§Ù†ÛŒÙ‡ ØªØ§ Ø¨Ø³ØªÙ†";

      if (countdownInterval) clearInterval(countdownInterval);

      countdownInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft > 0) {
          roleTimer.textContent = timeLeft + " Ø«Ø§Ù†ÛŒÙ‡ ØªØ§ Ø¨Ø³ØªÙ†";
        } else {
          clearInterval(countdownInterval);
          roleBox.classList.remove("show");
          revealedPlayers.add(index);
          btn.disabled = true;
          btn.classList.add("revealed");
          
          // Ø§Ú¯Ø± ØªÙ…Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§ Ù†Ù‚Ø´ Ø®ÙˆØ¯ Ø±Ø§ Ø¯ÛŒØ¯Ù†Ø¯
          if (revealedPlayers.size === numPlayers) {
            setTimeout(() => {
              document.getElementById("newRoundSection").classList.add("show");
            }, 500);
          }
        }
      }, 1000);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function renderRoleDescriptions() {
      const descGrid = document.getElementById("roleDescGrid");
      descGrid.innerHTML = "";

      for (const [role, info] of Object.entries(allRoles)) {
        const card = document.createElement("div");
        card.className = "role-card";
        card.innerHTML = `
          <div class="role-card-title">${info.emoji} ${role}</div>
          <div class="role-card-desc">${info.description}</div>
        `;
        descGrid.appendChild(card);
      }
    }

    // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    renderRoleDescriptions();
    
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ†Ø¯
    if (loadPlayerNames()) {
      numPlayers = playerNames.length;
      document.getElementById("numPlayers").value = numPlayers;
    }
  </script>
</body>
</html>
